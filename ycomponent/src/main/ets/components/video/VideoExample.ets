/**
 * Video Component Examples
 * OpenHarmony Video Component ä½¿ç”¨ç¤ºä¾‹
 *
 * å±•ç¤º Video è§†é¢‘æ’­æ”¾å™¨ç»„ä»¶çš„å„ç§ç”¨æ³•
 */

/**
 * è§†é¢‘é¡¹æ¥å£
 */
interface VideoItem {
  name: string
  url: string
}

/**
 * åŸºç¡€è§†é¢‘æ’­æ”¾å™¨ç¤ºä¾‹
 * å±•ç¤ºè§†é¢‘æ’­æ”¾çš„åŸºç¡€åŠŸèƒ½
 */
@ComponentV2
export struct BasicVideoExample {
  @Local currentTime: number = 0
  @Local duration: number = 0
  @Local isPlaying: boolean = false
  private controller: VideoController = new VideoController()

  build() {
    Column({ space: 12 }) {
      Text('Video Player è§†é¢‘æ’­æ”¾å™¨')
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
        .width('100%')
        .margin({ bottom: 8 })

      Video({
        src: 'https://media.w3.org/2010/05/sintel/trailer.mp4',
        controller: this.controller
      })
        .width('100%')
        .height(200)
        .autoPlay(false)
        .controls(true)
        .objectFit(ImageFit.Contain)
        .loop(false)
        .onStart(() => {
          this.isPlaying = true
          console.info('è§†é¢‘å¼€å§‹æ’­æ”¾')
        })
        .onPause(() => {
          this.isPlaying = false
          console.info('è§†é¢‘æš‚åœ')
        })
        .onFinish(() => {
          this.isPlaying = false
          console.info('è§†é¢‘æ’­æ”¾å®Œæˆ')
        })
        .onError(() => {
          this.isPlaying = false
          console.error('è§†é¢‘åŠ è½½å¤±è´¥')
        })
        .onPrepared((info: PreparedInfo) => {
          this.duration = info.duration
          console.info(`è§†é¢‘å‡†å¤‡å®Œæˆï¼Œæ—¶é•¿: ${info.duration}ç§’`)
        })
        .onSeeking((info: PlaybackInfo) => {
          console.info(`æ­£åœ¨è·³è½¬åˆ°: ${info.time}ç§’`)
        })
        .onSeeked((info: PlaybackInfo) => {
          this.currentTime = info.time
          console.info(`å·²è·³è½¬åˆ°: ${info.time}ç§’`)
        })
        .onUpdate((info: PlaybackInfo) => {
          this.currentTime = info.time
        })
        .borderRadius(8)

      // çŠ¶æ€æ˜¾ç¤º
      Text(`çŠ¶æ€: ${this.isPlaying ? 'æ’­æ”¾ä¸­' : 'å·²æš‚åœ'} | æ—¶é•¿: ${this.duration.toFixed(1)}s`)
        .fontSize(12)
        .fontColor('#666666')
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#F5F5F5')
    .borderRadius(12)
  }
}

/**
 * è‡ªå®šä¹‰æ§åˆ¶æ¡è§†é¢‘æ’­æ”¾å™¨
 * å±•ç¤ºå¦‚ä½•è‡ªå®šä¹‰è§†é¢‘æ§åˆ¶æ¡
 */
@ComponentV2
export struct CustomControlVideoExample {
  @Local currentTime: number = 0
  @Local duration: number = 0
  @Local isPlaying: boolean = false
  @Local isMuted: boolean = false
  @Local playbackSpeed: number = 1.0
  private controller: VideoController = new VideoController()

  build() {
    Column({ space: 12 }) {
      Text('è‡ªå®šä¹‰æ§åˆ¶æ¡')
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
        .width('100%')
        .margin({ bottom: 8 })

      Video({
        src: 'https://media.w3.org/2010/05/sintel/trailer.mp4',
        controller: this.controller
      })
        .width('100%')
        .height(200)
        .autoPlay(false)
        .controls(false)
        .objectFit(ImageFit.Contain)
        .onStart(() => {
          this.isPlaying = true
        })
        .onPause(() => {
          this.isPlaying = false
        })
        .onFinish(() => {
          this.isPlaying = false
        })
        .onPrepared((info: PreparedInfo) => {
          this.duration = info.duration
        })
        .onUpdate((info: PlaybackInfo) => {
          this.currentTime = info.time
        })
        .borderRadius(8)

      // è‡ªå®šä¹‰æ§åˆ¶æ¡
      Column({ space: 8 }) {
        // è¿›åº¦æ¡
        Row({ space: 8 }) {
          Text(`${this.currentTime.toFixed(1)}s`)
            .fontSize(12)
            .width(50)

          Slider({
            value: this.currentTime,
            min: 0,
            max: this.duration || 1
          })
            .layoutWeight(1)
            .blockColor('#007DFF')
            .trackColor('#E0E0E0')
            .selectedColor('#007DFF')
            .onChange((value: number) => {
              this.controller.setCurrentTime(value)
            })

          Text(`${this.duration.toFixed(1)}s`)
            .fontSize(12)
            .width(50)
            .textAlign(TextAlign.End)
        }
        .width('100%')

        // æŒ‰é’®ç»„
        Row({ space: 12 }) {
          // æ’­æ”¾/æš‚åœ
          Button(this.isPlaying ? 'â¸' : 'â–¶')
            .width(50)
            .height(36)
            .fontSize(16)
            .backgroundColor('#007DFF')
            .fontColor(Color.White)
            .onClick(() => {
              if (this.isPlaying) {
                this.controller.pause()
              } else {
                this.controller.start()
              }
            })

          // é™éŸ³/å–æ¶ˆé™éŸ³
          Button(this.isMuted ? 'ğŸ”‡' : 'ğŸ”Š')
            .width(50)
            .height(36)
            .fontSize(16)
            .backgroundColor('#6C757D')
            .fontColor(Color.White)
            .onClick(() => {
              this.isMuted = !this.isMuted
              // Video ç»„ä»¶ä¸ç›´æ¥æ”¯æŒé™éŸ³APIï¼Œæ­¤å¤„ä»…ä¸ºæ¼”ç¤º
              console.info(`é™éŸ³: ${this.isMuted}`)
            })

          // å€é€Ÿ
          Button(`${this.playbackSpeed}x`)
            .width(60)
            .height(36)
            .fontSize(12)
            .backgroundColor('#28A745')
            .fontColor(Color.White)
            .onClick(() => {
              const speeds = [0.5, 0.75, 1.0, 1.25, 1.5, 2.0]
              const currentIndex = speeds.indexOf(this.playbackSpeed)
              const nextIndex = (currentIndex + 1) % speeds.length
              this.playbackSpeed = speeds[nextIndex]
              console.info(`æ’­æ”¾é€Ÿåº¦: ${this.playbackSpeed}x`)
            })
        }
        .width('100%')
        .justifyContent(FlexAlign.SpaceEvenly)
      }
      .width('100%')
      .padding(12)
      .backgroundColor('#F5F5F5')
      .borderRadius(8)
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#F5F5F5')
    .borderRadius(12)
  }
}

/**
 * å¤šè§†é¢‘æºç¤ºä¾‹
 * å±•ç¤ºå¦‚ä½•å¤„ç†ä¸åŒçš„è§†é¢‘æº
 */
@ComponentV2
export struct MultipleVideoSourceExample {
  @Local selectedVideo: number = 0
  @Local currentTime: number = 0
  @Local duration: number = 0
  private controller: VideoController = new VideoController()

  videoList: VideoItem[] = [
    { name: 'ç¤ºä¾‹è§†é¢‘ 1', url: 'https://media.w3.org/2010/05/sintel/trailer.mp4' },
    { name: 'ç¤ºä¾‹è§†é¢‘ 2', url: 'https://media.w3.org/2010/05/bunny/trailer.mp4' }
  ]

  build() {
    Column({ space: 12 }) {
      Text('å¤šè§†é¢‘æºåˆ‡æ¢')
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
        .width('100%')
        .margin({ bottom: 8 })

      // è§†é¢‘æ’­æ”¾å™¨
      Video({
        src: this.videoList[this.selectedVideo].url,
        controller: this.controller
      })
        .width('100%')
        .height(200)
        .autoPlay(false)
        .controls(true)
        .objectFit(ImageFit.Contain)
        .onPrepared((info: PreparedInfo) => {
          this.duration = info.duration
        })
        .onUpdate((info: PlaybackInfo) => {
          this.currentTime = info.time
        })
        .borderRadius(8)

      // è§†é¢‘é€‰æ‹©å™¨
      Row({ space: 8 }) {
        ForEach(this.videoList, (video: VideoItem, index: number) => {
          Button(video.name)
            .height(36)
            .type(ButtonType.Normal)
            .backgroundColor(this.selectedVideo === index ? '#007DFF' : '#E0E0E0')
            .fontColor(this.selectedVideo === index ? Color.White : '#333333')
            .onClick(() => {
              if (this.selectedVideo !== index) {
                this.selectedVideo = index
                this.currentTime = 0
                this.duration = 0
                console.info(`åˆ‡æ¢åˆ°: ${video.name}`)
              }
            })
        })
      }
      .width('100%')
      .justifyContent(FlexAlign.SpaceEvenly)

      Text(`å½“å‰æ’­æ”¾: ${this.videoList[this.selectedVideo].name}`)
        .fontSize(12)
        .fontColor('#666666')
        .margin({ top: 8 })
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#F5F5F5')
    .borderRadius(12)
  }
}

/**
 * è§†é¢‘åˆ—è¡¨æ’­æ”¾ç¤ºä¾‹
 * å±•ç¤ºå¦‚ä½•åˆ›å»ºæ’­æ”¾åˆ—è¡¨
 */
@ComponentV2
export struct VideoPlaylistExample {
  @Local currentVideoIndex: number = 0
  @Local isPlaying: boolean = false
  private controller: VideoController = new VideoController()

  playlist: VideoItem[] = [
    { name: 'è§†é¢‘ 1', url: 'https://media.w3.org/2010/05/sintel/trailer.mp4' },
    { name: 'è§†é¢‘ 2', url: 'https://media.w3.org/2010/05/bunny/trailer.mp4' }
  ]

  build() {
    Column({ space: 12 }) {
      Text('è§†é¢‘æ’­æ”¾åˆ—è¡¨')
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
        .width('100%')
        .margin({ bottom: 8 })

      // å½“å‰è§†é¢‘
      Video({
        src: this.playlist[this.currentVideoIndex].url,
        controller: this.controller
      })
        .width('100%')
        .height(200)
        .autoPlay(false)
        .controls(true)
        .objectFit(ImageFit.Contain)
        .onFinish(() => {
          // è‡ªåŠ¨æ’­æ”¾ä¸‹ä¸€ä¸ª
          this.playNext()
        })
        .borderRadius(8)

      // æ’­æ”¾åˆ—è¡¨
      Column({ space: 8 }) {
        Text('æ’­æ”¾åˆ—è¡¨')
          .fontSize(16)
          .fontWeight(FontWeight.Medium)
          .width('100%')

        ForEach(this.playlist, (video: VideoItem, index: number) => {
          Row({ space: 12 }) {
            // æ’­æ”¾å›¾æ ‡
            Text(this.currentVideoIndex === index ? 'â–¶' : '')
              .fontSize(16)
              .fontColor('#007DFF')
              .width(20)

            // è§†é¢‘åç§°
            Text(video.name)
              .fontSize(14)
              .fontColor('#333333')
              .layoutWeight(1)
              .fontWeight(this.currentVideoIndex === index ? FontWeight.Medium : FontWeight.Normal)

            // å½“å‰æ’­æ”¾æŒ‡ç¤ºå™¨
            if (this.currentVideoIndex === index) {
              Text('æ’­æ”¾ä¸­')
                .fontSize(12)
                .fontColor('#28A745')
            }
          }
          .width('100%')
          .padding(12)
          .backgroundColor(this.currentVideoIndex === index ? '#E3F2FD' : '#FFFFFF')
          .borderRadius(8)
          .onClick(() => {
            if (this.currentVideoIndex !== index) {
              this.currentVideoIndex = index
              this.controller.start()
            }
          })
        }, (video: VideoItem, index: number) => `${index}_${video.name}`)
      }
      .width('100%')
      .padding(12)
      .backgroundColor('#F5F5F5')
      .borderRadius(8)

      // æ§åˆ¶æŒ‰é’®
      Row({ space: 12 }) {
        Button('ä¸Šä¸€ä¸ª')
          .height(36)
          .type(ButtonType.Capsule)
          .enabled(this.currentVideoIndex > 0)
          .onClick(() => {
            this.playPrevious()
          })

        Button('ä¸‹ä¸€ä¸ª')
          .height(36)
          .type(ButtonType.Capsule)
          .enabled(this.currentVideoIndex < this.playlist.length - 1)
          .onClick(() => {
            this.playNext()
          })
      }
      .width('100%')
      .justifyContent(FlexAlign.SpaceEvenly)
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#F5F5F5')
    .borderRadius(12)
  }

  playNext() {
    if (this.currentVideoIndex < this.playlist.length - 1) {
      this.currentVideoIndex++
      this.controller.start()
    }
  }

  playPrevious() {
    if (this.currentVideoIndex > 0) {
      this.currentVideoIndex--
      this.controller.start()
    }
  }
}

/**
 * è§†é¢‘å°é¢å’Œè‡ªåŠ¨æ’­æ”¾ç¤ºä¾‹
 */
@ComponentV2
export struct VideoWithPosterExample {
  @Local isPlaying: boolean = false
  @Local hasStarted: boolean = false
  private controller: VideoController = new VideoController()

  build() {
    Column({ space: 12 }) {
      Text('è§†é¢‘å°é¢å’Œè‡ªåŠ¨æ’­æ”¾')
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
        .width('100%')
        .margin({ bottom: 8 })

      Stack() {
        Video({
          src: 'https://media.w3.org/2010/05/sintel/trailer.mp4',
          controller: this.controller
        })
          .width('100%')
          .height(200)
          .autoPlay(false)
          .controls(false)
          .objectFit(ImageFit.Cover)
          .onStart(() => {
            this.isPlaying = true
            this.hasStarted = true
          })
          .onPause(() => {
            this.isPlaying = false
          })
          .borderRadius(8)

        // å°é¢/æ’­æ”¾æŒ‰é’®
        if (!this.hasStarted) {
          Column({ space: 12 }) {
            Button('â–¶')
              .width(60)
              .height(60)
              .type(ButtonType.Circle)
              .fontSize(24)
              .backgroundColor('rgba(0, 122, 255, 0.9)')
              .fontColor(Color.White)
              .onClick(() => {
                this.hasStarted = true
                this.controller.start()
              })

            Text('ç‚¹å‡»æ’­æ”¾è§†é¢‘')
              .fontSize(14)
              .fontColor(Color.White)
              .fontWeight(FontWeight.Medium)
          }
          .justifyContent(FlexAlign.Center)
          .width('100%')
          .height('100%')
          .backgroundColor('rgba(0, 0, 0, 0.3)')
          .borderRadius(8)
        }
      }
      .width('100%')
      .height(200)

      // æ§åˆ¶æŒ‰é’®
      if (this.hasStarted) {
        Row({ space: 12 }) {
          Button(this.isPlaying ? 'æš‚åœ' : 'æ’­æ”¾')
            .height(36)
            .type(ButtonType.Capsule)
            .onClick(() => {
              if (this.isPlaying) {
                this.controller.pause()
              } else {
                this.controller.start()
              }
            })

          Button('é‡ç½®')
            .height(36)
            .type(ButtonType.Capsule)
            .onClick(() => {
              this.hasStarted = false
              this.isPlaying = false
              this.controller.setCurrentTime(0)
            })
        }
        .width('100%')
        .justifyContent(FlexAlign.SpaceEvenly)
      }
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#F5F5F5')
    .borderRadius(12)
  }
}

/**
 * è§†é¢‘æ§åˆ¶æ–¹æ³•ç¤ºä¾‹
 * å±•ç¤º VideoController çš„å„ç§æ§åˆ¶æ–¹æ³•
 */
@ComponentV2
export struct VideoControllerExample {
  @Local currentTime: number = 0
  @Local duration: number = 0
  @Local statusMessage: string = 'å‡†å¤‡å°±ç»ª'
  private controller: VideoController = new VideoController()

  build() {
    Column({ space: 12 }) {
      Text('VideoController æ§åˆ¶æ–¹æ³•')
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
        .width('100%')
        .margin({ bottom: 8 })

      Video({
        src: 'https://media.w3.org/2010/05/sintel/trailer.mp4',
        controller: this.controller
      })
        .width('100%')
        .height(180)
        .autoPlay(false)
        .controls(true)
        .onPrepared((info: PreparedInfo) => {
          this.duration = info.duration
          this.statusMessage = `è§†é¢‘å·²åŠ è½½ï¼Œæ—¶é•¿: ${info.duration.toFixed(1)}s`
        })
        .onUpdate((info: PlaybackInfo) => {
          this.currentTime = info.time
        })
        .borderRadius(8)

      // çŠ¶æ€ä¿¡æ¯
      Text(this.statusMessage)
        .fontSize(12)
        .fontColor('#666666')
        .margin({ top: 4 })

      // æ§åˆ¶æŒ‰é’®ç»„
      Column({ space: 8 }) {
        Text('æ§åˆ¶æ–¹æ³•')
          .fontSize(14)
          .fontWeight(FontWeight.Medium)

        Row({ space: 8 }) {
          Button('å¼€å§‹')
            .height(36)
            .layoutWeight(1)
            .onClick(() => {
              this.controller.start()
              this.statusMessage = 'å¼€å§‹æ’­æ”¾'
            })

          Button('æš‚åœ')
            .height(36)
            .layoutWeight(1)
            .onClick(() => {
              this.controller.pause()
              this.statusMessage = 'å·²æš‚åœ'
            })

          Button('åœæ­¢')
            .height(36)
            .layoutWeight(1)
            .onClick(() => {
              this.controller.pause()
              this.controller.setCurrentTime(0)
              this.statusMessage = 'å·²åœæ­¢'
            })
        }
        .width('100%')

        Row({ space: 8 }) {
          Button('è·³è½¬è‡³ 5s')
            .height(36)
            .layoutWeight(1)
            .onClick(() => {
              this.controller.setCurrentTime(5)
              this.statusMessage = 'è·³è½¬è‡³ 5 ç§’'
            })

          Button('è·³è½¬è‡³ 15s')
            .height(36)
            .layoutWeight(1)
            .onClick(() => {
              this.controller.setCurrentTime(15)
              this.statusMessage = 'è·³è½¬è‡³ 15 ç§’'
            })
        }
        .width('100%')

        Button('è®¾ç½®å½“å‰æ—¶é—´ä¸º 0')
          .height(36)
          .width('100%')
          .onClick(() => {
            this.controller.setCurrentTime(0)
            this.statusMessage = 'é‡ç½®åˆ°å¼€å§‹'
          })
      }
      .width('100%')
      .padding(12)
      .backgroundColor('#FFFFFF')
      .borderRadius(8)

      Text(`å½“å‰æ—¶é—´: ${this.currentTime.toFixed(1)}s / ${this.duration.toFixed(1)}s`)
        .fontSize(12)
        .fontColor('#666666')
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#F5F5F5')
    .borderRadius(12)
  }
}

/**
 * å®Œæ•´çš„è§†é¢‘æ’­æ”¾å™¨ç¤ºä¾‹é¡µé¢
 * é›†æˆæ‰€æœ‰è§†é¢‘æ’­æ”¾å™¨ç¤ºä¾‹
 */
@ComponentV2
export struct VideoExamplePage {
  build() {
    NavDestination() {
      Scroll() {
        Column({ space: 20 }) {
          Text('Video Component Examples')
            .fontSize(24)
            .fontWeight(FontWeight.Bold)
            .width('100%')
            .padding({ left: 16, right: 16, top: 16, bottom: 8 })

          BasicVideoExample()
          CustomControlVideoExample()
          MultipleVideoSourceExample()
          VideoPlaylistExample()
          VideoWithPosterExample()
          VideoControllerExample()
        }
        .width('100%')
      }
      .width('100%')
      .height('100%')
      .backgroundColor('#FFFFFF')
    }
    .title('Video è§†é¢‘æ’­æ”¾å™¨ç»„ä»¶ç¤ºä¾‹')
    .mode(NavDestinationMode.STANDARD)
  }
}

@Builder
export function VideoExamplePageBuilder() {
  VideoExamplePage()
}
