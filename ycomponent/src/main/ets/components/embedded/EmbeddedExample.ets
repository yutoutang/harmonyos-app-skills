/**
 * EmbeddedComponent/XComponent Component Examples
 * OpenHarmony åµŒå…¥å¼ç»„ä»¶ä½¿ç”¨ç¤ºä¾‹
 *
 * æœ¬ç¤ºä¾‹å±•ç¤ºå¦‚ä½•ä½¿ç”¨ EmbeddedComponent å’Œ XComponent ç»„ä»¶
 * æ³¨æ„ï¼šè¿™äº›ç»„ä»¶éœ€è¦ç‰¹æ®Šçš„ native é…ç½®å’Œæƒé™è®¾ç½®
 */

import { Want } from '@kit.AbilityKit';

/**
 * åµŒå…¥ç»„ä»¶é¡¹æ¥å£
 */
interface EmbeddedItem {
  name: string
  want: Want
}

/**
 * ç”¨ä¾‹å¡ç‰‡å‚æ•°æ¥å£
 */
interface UseCaseCardParams {
  title: string
  description: string
  icon: string
  color: string
}

/**
 * åŸºç¡€ EmbeddedComponent ç¤ºä¾‹
 * æ¼”ç¤ºå¦‚ä½•åµŒå…¥å…¶ä»– Ability æˆ–ç»„ä»¶
 */
@ComponentV2
export struct EmbeddedComponentExample {
  @Local embeddedWant: Want = {
    bundleName: 'com.example.embedded',
    abilityName: 'EmbeddedAbility',
    moduleName: 'entry'
  }
  @Local isLoaded: boolean = false
  @Local errorMessage: string = ''
  @Local componentName: string = ''

  build() {
    Column({ space: 12 }) {
      // æ ‡é¢˜å’Œæè¿°
      this.buildHeader()

      // çŠ¶æ€æ˜¾ç¤º
      if (this.isLoaded) {
        this.buildSuccessStatus()
      } else if (this.errorMessage) {
        this.buildErrorStatus()
      }

      // EmbeddedComponent å®¹å™¨
      this.buildEmbeddedComponent()

      // è¯´æ˜æ–‡æœ¬
      this.buildDescription()
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#F5F5F5')
    .borderRadius(12)
  }

  @Builder
  buildHeader() {
    Column({ space: 4 }) {
      Text('EmbeddedComponent ç¤ºä¾‹')
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
        .width('100%')

      Text('ç”¨äºåœ¨åº”ç”¨ä¸­åµŒå…¥å…¶ä»–ç»„ä»¶æˆ–åº”ç”¨')
        .fontSize(14)
        .fontColor('#666666')
    }
    .width('100%')
    .alignItems(HorizontalAlign.Start)
  }

  @Builder
  buildSuccessStatus() {
    Row({ space: 8 }) {
      Text('âœ“')
        .fontSize(16)
        .fontColor(Color.Green)

      Text(`å·²åŠ è½½: ${this.componentName}`)
        .fontSize(14)
        .fontColor(Color.Green)
        .layoutWeight(1)
    }
    .width('100%')
    .padding(12)
    .backgroundColor('#E8F5E9')
    .borderRadius(8)
  }

  @Builder
  buildErrorStatus() {
    Row({ space: 8 }) {
      Text('âœ—')
        .fontSize(16)
        .fontColor(Color.Red)

      Text(`é”™è¯¯: ${this.errorMessage}`)
        .fontSize(14)
        .fontColor(Color.Red)
        .layoutWeight(1)
    }
    .width('100%')
    .padding(12)
    .backgroundColor('#FFEBEE')
    .borderRadius(8)
  }

  @Builder
  buildEmbeddedComponent() {
    Column() {
      // æ³¨æ„ï¼šè¿™é‡Œä½¿ç”¨å ä½ç¬¦ï¼Œå®é™…ä½¿ç”¨æ—¶éœ€è¦é…ç½®æœ‰æ•ˆçš„ Want
      Text('EmbeddedComponent å®¹å™¨åŒºåŸŸ')
        .fontSize(16)
        .fontColor('#999999')
        .width('100%')
        .textAlign(TextAlign.Center)
        .padding(48)
        .border({ width: 2, color: '#DDDDDD', style: BorderStyle.Dashed })
        .borderRadius(8)
        .backgroundColor('#FAFAFA')

      // å®é™…ä½¿ç”¨ç¤ºä¾‹ï¼ˆæ³¨é‡Šæ‰çš„ä»£ç ï¼‰:
      /*
      EmbeddedComponent({
        want: this.embeddedWant,
        moduleName: 'entry',
        onLoad: (event) => {
          this.isLoaded = true
          this.componentName = event.componentName || 'Unknown'
          this.errorMessage = ''
        },
        onError: (event) => {
          this.isLoaded = false
          this.errorMessage = event.errorMsg || 'Unknown error'
        }
      })
      .width('100%')
      .height(200)
      .border({ width: 1, color: Color.Gray, radius: 8 })
      */
    }
    .width('100%')
  }

  @Builder
  buildDescription() {
    Column({ space: 8 }) {
      this.buildNoteItem('âš ', 'éœ€è¦é…ç½®æœ‰æ•ˆçš„ Want å¯¹è±¡ï¼ˆbundleName, abilityNameï¼‰')
      this.buildNoteItem('âš ', 'ç›®æ ‡ Ability çš„ exported å±æ€§å¿…é¡»ä¸º true')
      this.buildNoteItem('âš ', 'éœ€è¦ç›¸åº”çš„æƒé™é…ç½®')
      this.buildNoteItem('â„¹', 'ç¤ºä¾‹ä¸­ä½¿ç”¨å ä½ç¬¦ï¼Œå®é™…ä½¿ç”¨æ—¶å–æ¶ˆæ³¨é‡Š')
    }
    .width('100%')
    .padding(12)
    .backgroundColor('#FFF3E0')
    .borderRadius(8)
  }

  @Builder
  buildNoteItem(icon: string, text: string) {
    Row({ space: 8 }) {
      Text(icon)
        .fontSize(14)

      Text(text)
        .fontSize(12)
        .fontColor('#666666')
        .layoutWeight(1)
    }
    .width('100%')
    .alignItems(VerticalAlign.Top)
  }
}

/**
 * åŠ¨æ€åˆ‡æ¢åµŒå…¥ç»„ä»¶ç¤ºä¾‹
 * æ¼”ç¤ºå¦‚ä½•åœ¨å¤šä¸ªåµŒå…¥ç»„ä»¶ä¹‹é—´åˆ‡æ¢
 */
@ComponentV2
export struct DynamicEmbeddedExample {
  @Local currentIndex: number = 0
  @Local embeddedList: EmbeddedItem[] = [
    {
      name: 'ç»„ä»¶ 1',
      want: {
        bundleName: 'com.example.app1',
        abilityName: 'Component1Ability',
        moduleName: 'entry'
      }
    },
    {
      name: 'ç»„ä»¶ 2',
      want: {
        bundleName: 'com.example.app2',
        abilityName: 'Component2Ability',
        moduleName: 'entry'
      }
    },
    {
      name: 'ç»„ä»¶ 3',
      want: {
        bundleName: 'com.example.app3',
        abilityName: 'Component3Ability',
        moduleName: 'entry'
      }
    }
  ]

  build() {
    Column({ space: 12 }) {
      // æ ‡é¢˜
      Text('åŠ¨æ€åˆ‡æ¢ç¤ºä¾‹')
        .fontSize(18)
        .fontWeight(FontWeight.Medium)
        .width('100%')

      // å¯¼èˆªæŒ‰é’®
      Row({ space: 12 }) {
        Button('ä¸Šä¸€ä¸ª')
          .enabled(this.currentIndex > 0)
          .onClick(() => {
            if (this.currentIndex > 0) {
              this.currentIndex--
            }
          })

        Text(`${this.currentIndex + 1} / ${this.embeddedList.length}`)
          .fontSize(14)
          .fontColor('#666666')
          .textAlign(TextAlign.Center)
          .width(60)

        Button('ä¸‹ä¸€ä¸ª')
          .enabled(this.currentIndex < this.embeddedList.length - 1)
          .onClick(() => {
            if (this.currentIndex < this.embeddedList.length - 1) {
              this.currentIndex++
            }
          })
      }
      .width('100%')
      .justifyContent(FlexAlign.SpaceBetween)

      // å½“å‰ç»„ä»¶ä¿¡æ¯
      Text(`å½“å‰: ${this.embeddedList[this.currentIndex].name}`)
        .fontSize(14)
        .fontColor('#333333')
        .width('100%')
        .padding(8)
        .backgroundColor('#E3F2FD')
        .borderRadius(6)

      // åµŒå…¥ç»„ä»¶å ä½ç¬¦
      Column() {
        Text('EmbeddedComponent å®¹å™¨')
          .fontSize(14)
          .fontColor('#999999')
          .padding(32)
          .border({ width: 2, color: '#DDDDDD', style: BorderStyle.Dashed })
          .borderRadius(8)
      }
      .width('100%')
      .height(180)
      .justifyContent(FlexAlign.Center)
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#F5F5F5')
    .borderRadius(12)
  }
}

/**
 * åŸºç¡€ XComponent ç¤ºä¾‹
 * æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ XComponent åµŒå…¥ Native C++ æ¸²æŸ“å†…å®¹
 */
@ComponentV2
export struct XComponentExample {
  @Local xComponentId: string = 'xcomponent_surface'
  @Local surfaceWidth: number = 0
  @Local surfaceHeight: number = 0
  @Local isInitialized: boolean = false

  build() {
    Column({ space: 12 }) {
      // æ ‡é¢˜å’Œæè¿°
      this.buildHeader()

      // å°ºå¯¸ä¿¡æ¯
      if (this.isInitialized) {
        this.buildSizeInfo()
      }

      // XComponent å®¹å™¨
      this.buildXComponent()

      // è¯´æ˜æ–‡æœ¬
      this.buildDescription()
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#F5F5F5')
    .borderRadius(12)
  }

  @Builder
  buildHeader() {
    Column({ space: 4 }) {
      Text('XComponent ç¤ºä¾‹')
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
        .width('100%')

      Text('ç”¨äºåµŒå…¥åŸç”Ÿ C++ ç»˜åˆ¶å†…å®¹')
        .fontSize(14)
        .fontColor('#666666')
    }
    .width('100%')
    .alignItems(HorizontalAlign.Start)
  }

  @Builder
  buildSizeInfo() {
    Row({ space: 12 }) {
      Row({ space: 4 }) {
        Text('å®½åº¦:')
          .fontSize(12)
          .fontColor('#666666')
        Text(`${this.surfaceWidth}px`)
          .fontSize(12)
          .fontWeight(FontWeight.Medium)
      }

      Row({ space: 4 }) {
        Text('é«˜åº¦:')
          .fontSize(12)
          .fontColor('#666666')
        Text(`${this.surfaceHeight}px`)
          .fontSize(12)
          .fontWeight(FontWeight.Medium)
      }
    }
    .width('100%')
    .padding(8)
    .backgroundColor('#E8F5E9')
    .borderRadius(6)
  }

  @Builder
  buildXComponent() {
    Column() {
      // å ä½ç¬¦æ˜¾ç¤º
      Text('XComponent å®¹å™¨åŒºåŸŸ')
        .fontSize(16)
        .fontColor('#999999')
        .width('100%')
        .textAlign(TextAlign.Center)
        .padding(48)
        .border({ width: 2, color: '#DDDDDD', style: BorderStyle.Dashed })
        .borderRadius(8)
        .backgroundColor('#FAFAFA')

      // å®é™…ä½¿ç”¨ç¤ºä¾‹ï¼ˆæ³¨é‡Šæ‰çš„ä»£ç ï¼‰:
      /*
      XComponent({
        id: this.xComponentId,
        type: 'surface',
        libraryname: 'xcomponentdemo',
        onload: (context) => {
          this.isInitialized = true
          this.surfaceWidth = context.xComponentWidth
          this.surfaceHeight = context.xComponentHeight
          console.info('XComponent loaded:', context.xComponentId)
        },
        onDestroy: () => {
          this.isInitialized = false
          console.info('XComponent destroyed')
        }
      })
      .width('100%')
      .height(200)
      .border({ width: 1, color: Color.Gray, radius: 8 })
      */
    }
    .width('100%')
  }

  @Builder
  buildDescription() {
    Column({ space: 8 }) {
      this.buildNoteItem('âš ', 'éœ€è¦ native é¡¹ç›®é…ç½®ï¼ˆCMakeLists.txtï¼‰')
      this.buildNoteItem('âš ', 'éœ€è¦ç¼–è¯‘ .so åŠ¨æ€åº“æ–‡ä»¶')
      this.buildNoteItem('âš ', 'éœ€è¦é…ç½® build-profile.json5 å¯ç”¨ C++ æ”¯æŒ')
      this.buildNoteItem('â„¹', 'é€‚ç”¨äº OpenGL/Vulkan æ¸²æŸ“ã€æ¸¸æˆã€è§†é¢‘å¤„ç†ç­‰åœºæ™¯')
      this.buildNoteItem('â„¹', 'ç¤ºä¾‹ä¸­ä½¿ç”¨å ä½ç¬¦ï¼Œå®é™…ä½¿ç”¨æ—¶å–æ¶ˆæ³¨é‡Š')
    }
    .width('100%')
    .padding(12)
    .backgroundColor('#FFF3E0')
    .borderRadius(8)
  }

  @Builder
  buildNoteItem(icon: string, text: string) {
    Row({ space: 8 }) {
      Text(icon)
        .fontSize(14)

      Text(text)
        .fontSize(12)
        .fontColor('#666666')
        .layoutWeight(1)
    }
    .width('100%')
    .alignItems(VerticalAlign.Top)
  }
}

/**
 * å¯è°ƒæ•´å¤§å°çš„ XComponent ç¤ºä¾‹
 * æ¼”ç¤ºåŠ¨æ€è°ƒæ•´ XComponent å°ºå¯¸
 */
@ComponentV2
export struct ResizableXComponentExample {
  @Local componentHeight: number = 300
  @Local context: object | null = null

  build() {
    Column({ space: 12 }) {
      // æ ‡é¢˜
      Text('å¯è°ƒæ•´å¤§å°ç¤ºä¾‹')
        .fontSize(18)
        .fontWeight(FontWeight.Medium)
        .width('100%')

      // æ§åˆ¶æŒ‰é’®
      Row({ space: 12 }) {
        Button('æ”¾å¤§')
          .onClick(() => {
            if (this.componentHeight < 600) {
              this.componentHeight += 50
            }
          })

        Text(`${this.componentHeight}px`)
          .fontSize(14)
          .fontColor('#666666')
          .width(80)
          .textAlign(TextAlign.Center)

        Button('ç¼©å°')
          .onClick(() => {
            if (this.componentHeight > 150) {
              this.componentHeight -= 50
            }
          })
      }
      .width('100%')
      .justifyContent(FlexAlign.SpaceBetween)

      // XComponent å®¹å™¨
      Column() {
        Text('XComponent å®¹å™¨')
          .fontSize(14)
          .fontColor('#999999')
          .width('100%')
          .textAlign(TextAlign.Center)
          .padding(32)
          .border({ width: 2, color: '#DDDDDD', style: BorderStyle.Dashed })
          .borderRadius(8)
      }
      .width('100%')
      .height(this.componentHeight)
      .justifyContent(FlexAlign.Center)
      .animation({ duration: 300, curve: Curve.EaseInOut })

      // è¯´æ˜
      Text('æç¤º: å®é™…ä½¿ç”¨æ—¶ï¼ŒNative å±‚éœ€è¦å“åº”å°ºå¯¸å˜åŒ–')
        .fontSize(12)
        .fontColor('#999999')
        .width('100%')
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#F5F5F5')
    .borderRadius(12)
  }
}

/**
 * åº”ç”¨åœºæ™¯ç¤ºä¾‹å¡ç‰‡
 */
@ComponentV2
export struct UseCaseCard {
  @Param title: string = ''
  @Param description: string = ''
  @Param icon: string = ''
  @Param color: string = '#2196F3'

  build() {
    Row({ space: 12 }) {
      // å›¾æ ‡
      Text(this.icon)
        .fontSize(32)
        .width(50)
        .height(50)
        .textAlign(TextAlign.Center)
        .backgroundColor(this.color)
        .fontColor(Color.White)
        .borderRadius(8)

      // å†…å®¹
      Column({ space: 4 }) {
        Text(this.title)
          .fontSize(16)
          .fontWeight(FontWeight.Medium)
          .fontColor('#333333')

        Text(this.description)
          .fontSize(13)
          .fontColor('#666666')
          .lineHeight(18)
      }
      .alignItems(HorizontalAlign.Start)
      .layoutWeight(1)
    }
    .width('100%')
    .padding(12)
    .backgroundColor(Color.White)
    .borderRadius(8)
    .border({ width: 1, color: '#E0E0E0' })
  }
}

/**
 * åº”ç”¨åœºæ™¯ç¤ºä¾‹
 */
@ComponentV2
export struct UseCasesExample {
  build() {
    Column({ space: 16 }) {
      // æ ‡é¢˜
      Text('åº”ç”¨åœºæ™¯')
        .fontSize(20)
        .fontWeight(FontWeight.Bold)
        .width('100%')

      // XComponent åº”ç”¨åœºæ™¯
      Column({ space: 12 }) {
        Text('XComponent åº”ç”¨åœºæ™¯')
          .fontSize(16)
          .fontWeight(FontWeight.Medium)
          .fontColor('#2196F3')
          .width('100%')

        UseCaseCard({
          title: 'æ¸¸æˆå¼€å‘',
          description: 'ä½¿ç”¨ OpenGL/Vulkan è¿›è¡Œé«˜æ€§èƒ½æ¸¸æˆæ¸²æŸ“',
          icon: 'ğŸ®',
          color: '#FF5722'
        })

        UseCaseCard({
          title: 'è§†é¢‘å¤„ç†',
          description: 'è§†é¢‘æ’­æ”¾ã€æ»¤é•œã€ç‰¹æ•ˆå¤„ç†',
          icon: 'ğŸ¬',
          color: '#E91E63'
        })

        UseCaseCard({
          title: 'ç›¸æœºé¢„è§ˆ',
          description: 'å®æ—¶ç›¸æœºé¢„è§ˆå’Œå›¾åƒå¤„ç†',
          icon: 'ğŸ“·',
          color: '#9C27B0'
        })

        UseCaseCard({
          title: 'å›¾å½¢æ¸²æŸ“',
          description: 'å¤æ‚çš„ 2D/3D å›¾å½¢å’Œå¯è§†åŒ–',
          icon: 'ğŸ¨',
          color: '#673AB7'
        })
      }
      .width('100%')

      // EmbeddedComponent åº”ç”¨åœºæ™¯
      Column({ space: 12 }) {
        Text('EmbeddedComponent åº”ç”¨åœºæ™¯')
          .fontSize(16)
          .fontWeight(FontWeight.Medium)
          .fontColor('#4CAF50')
          .width('100%')

        UseCaseCard({
          title: 'ç»„ä»¶å¤ç”¨',
          description: 'åµŒå…¥å…¶ä»–åº”ç”¨çš„åŠŸèƒ½ç»„ä»¶',
          icon: 'ğŸ”„',
          color: '#4CAF50'
        })

        UseCaseCard({
          title: 'èƒ½åŠ›é›†æˆ',
          description: 'é›†æˆå…¶ä»– Ability çš„èƒ½åŠ›',
          icon: 'ğŸ”—',
          color: '#009688'
        })

        UseCaseCard({
          title: 'æ’ä»¶åŒ–æ¶æ„',
          description: 'å®ç°æ’ä»¶åŒ–å’Œæ¨¡å—åŒ–',
          icon: 'ğŸ§©',
          color: '#3F51B5'
        })
      }
      .width('100%')
    }
    .width('100%')
    .padding(16)
    .backgroundColor('#F5F5F5')
    .borderRadius(12)
  }
}

/**
 * ä¸»é¡µé¢ - åµŒå…¥å¼ç»„ä»¶ç¤ºä¾‹é›†åˆ
 */
@ComponentV2
export struct EmbeddedExamplePage {
  build() {
    NavDestination() {
      Scroll() {
        Column({ space: 20 }) {
          // é¡µé¢æ ‡é¢˜
          Text('Embedded Component Examples')
            .fontSize(24)
            .fontWeight(FontWeight.Bold)
            .width('100%')
            .padding({
              left: 16,
              right: 16,
              top: 16,
              bottom: 8
            })

          // EmbeddedComponent åŸºç¡€ç¤ºä¾‹
          EmbeddedComponentExample()

          // åŠ¨æ€åˆ‡æ¢ç¤ºä¾‹
          DynamicEmbeddedExample()

          // XComponent åŸºç¡€ç¤ºä¾‹
          XComponentExample()

          // å¯è°ƒæ•´å¤§å°ç¤ºä¾‹
          ResizableXComponentExample()

          // åº”ç”¨åœºæ™¯
          UseCasesExample()

          // åº•éƒ¨è¯´æ˜
          this.buildFooter()
        }
        .width('100%')
      }
      .width('100%')
      .height('100%')
      .backgroundColor('#FFFFFF')
      .scrollBar(BarState.Auto)
    }
    .title('Embedded åµŒå…¥ç»„ä»¶')
    .mode(NavDestinationMode.STANDARD)
  }

  @Builder
  buildFooter() {
    Column({ space: 12 }) {
      Text('é‡è¦æç¤º')
        .fontSize(16)
        .fontWeight(FontWeight.Medium)
        .fontColor('#F57C00')
        .width('100%')

      Column({ space: 8 }) {
        this.buildFooterItem('EmbeddedComponent å’Œ XComponent éƒ½éœ€è¦ç‰¹æ®Šçš„é…ç½®')
        this.buildFooterItem('EmbeddedComponent éœ€è¦ target Ability çš„ exported=true')
        this.buildFooterItem('XComponent éœ€è¦ native é¡¹ç›®é…ç½®å’Œ .so æ–‡ä»¶')
        this.buildFooterItem('è¯·å‚è€ƒæŠ€èƒ½æ–‡æ¡£äº†è§£è¯¦ç»†é…ç½®æ­¥éª¤')
        this.buildFooterItem('ç¤ºä¾‹ä¸­ä½¿ç”¨å ä½ç¬¦ï¼Œå®é™…ä½¿ç”¨æ—¶éœ€è¦å–æ¶ˆæ³¨é‡Šå¹¶é…ç½®')
      }
      .width('100%')
      .padding(12)
      .backgroundColor('#FFF3E0')
      .borderRadius(8)
    }
    .width('100%')
    .padding(16)
  }

  @Builder
  buildFooterItem(text: string) {
    Row({ space: 8 }) {
      Text('â€¢')
        .fontSize(14)
        .fontColor('#F57C00')

      Text(text)
        .fontSize(13)
        .fontColor('#666666')
        .layoutWeight(1)
    }
    .width('100%')
  }
}

@Builder
export function EmbeddedExamplePageBuilder() {
  EmbeddedExamplePage()
}
